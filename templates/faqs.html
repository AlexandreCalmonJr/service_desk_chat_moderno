{% extends "base_layout.html" %}

{% block title %}Ver FAQs{% endblock %}

{% block content %}
<div class="w-full max-w-6xl mx-auto p-6 bg-gray-900/50 backdrop-blur-sm border border-gray-700 rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold text-green-400 mb-6 text-center">Perguntas Frequentes (FAQs)</h2>

    <!-- Formulário de Edição (só aparece quando se está a editar) -->
    {% if faq_to_edit and current_user.is_admin %}
    <div class="mb-10 p-6 border rounded-lg border-gray-700 bg-gray-800/50">
        <h3 class="text-xl font-semibold mb-4 text-yellow-400">A Editar FAQ: "{{ faq_to_edit.question }}"</h3>
        <form method="POST" action="{{ url_for('edit_faq', faq_id=faq_to_edit.id) }}" enctype="multipart/form-data" class="space-y-4">
            <div>
                <label for="edit_category" class="block text-sm font-medium text-gray-300">Categoria</label>
                <select name="edit_category" id="edit_category" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md">
                    {% for category in categories %}
                        <option value="{{ category.id }}" {% if category.id == faq_to_edit.category_id %}selected{% endif %}>{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="edit_question" class="block text-sm font-medium text-gray-300">Pergunta</label>
                <input type="text" id="edit_question" name="edit_question" value="{{ faq_to_edit.question }}" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md">
            </div>
            <div>
                <label for="edit_answer" class="block text-sm font-medium text-gray-300">Resposta</label>
                <textarea id="edit_answer" name="edit_answer" rows="4" required class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md">{{ faq_to_edit.answer }}</textarea>
            </div>
            <!-- Outros campos de edição (imagem, vídeo, ficheiro) aqui -->
            <div class="flex gap-4">
                 <a href="{{ url_for('faqs') }}" class="w-full text-center py-2 px-4 rounded-md font-medium text-white bg-gray-600 hover:bg-gray-700">Cancelar</a>
                <button type="submit" name="edit_faq" class="w-full py-2 px-4 rounded-md font-medium text-white bg-green-600 hover:bg-green-700">Guardar Alterações</button>
            </div>
        </form>
    </div>
    {% endif %}

    <!-- Tabela de FAQs -->
    <form method="POST" action="{{ url_for('delete_multiple_faqs') }}" id="faq-form">
        <div class="overflow-x-auto">
            <table class="w-full text-left">
                <thead>
                    <tr class="bg-gray-800 border-b border-gray-700">
                        {% if current_user.is_admin %}
                        <th class="p-3"><input type="checkbox" id="select-all" class="bg-gray-700 border-gray-600"></th>
                        {% endif %}
                        <th class="p-3">Pergunta</th>
                        <th class="p-3">Categoria</th>
                        <th class="p-3">Média</th>
                        {% if current_user.is_admin %}
                        <th class="p-3">Ações</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for faq in faqs %}
                    <tr class="border-b border-gray-700 hover:bg-gray-800/50">
                        {% if current_user.is_admin %}
                        <td class="p-3"><input type="checkbox" name="faq_ids" value="{{ faq.id }}" class="bg-gray-700 border-gray-600"></td>
                        {% endif %}
                        <td class="p-3 text-white font-semibold">{{ faq.question }}</td>
                        <td class="p-3">{{ faq.category.name }}</td>
                        <td class="p-3">
                            {% if faq.image_url or faq.video_url or faq.file_name %}
                                <div class="flex gap-3 text-gray-400">
                                    {% if faq.image_url %}<a href="{{ faq.image_url }}" target="_blank" title="Ver Imagem"><i class="fas fa-image"></i></a>{% endif %}
                                    {% if faq.video_url %}<a href="{{ faq.video_url }}" target="_blank" title="Ver Vídeo"><i class="fas fa-video"></i></a>{% endif %}
                                    {% if faq.file_name %}<a href="{{ url_for('download', faq_id=faq.id) }}" title="Baixar Ficheiro"><i class="fas fa-file-download"></i></a>{% endif %}
                                </div>
                            {% endif %}
                        </td>
                        {% if current_user.is_admin %}
                        <td class="p-3 flex gap-2">
                             <a href="{{ url_for('faqs', edit=faq.id) }}" class="px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm transition" title="Editar"><i class="fas fa-edit"></i></a>
                            <form method="POST" action="{{ url_for('delete_faq', faq_id=faq.id) }}" onsubmit="return confirm('Tem a certeza?');" class="inline-block">
                                <button type="submit" class="px-3 py-1 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm transition" title="Apagar"><i class="fas fa-trash"></i></button>
                            </form>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if current_user.is_admin %}
        <div class="flex justify-end mt-4">
            <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition" onclick="return confirm('Tem a certeza que quer apagar as FAQs selecionadas?');">
                <i class="fas fa-trash"></i> Apagar Selecionados
            </button>
        </div>
        {% endif %}
    </form>
</div>
<script>
    // Script para selecionar todos os checkboxes
    const selectAll = document.getElementById('select-all');
    if (selectAll) {
        selectAll.addEventListener('change', (event) => {
            document.querySelectorAll('input[name="faq_ids"]').forEach(checkbox => {
                checkbox.checked = event.target.checked;
            });
        });
    }
</script>
{% endblock %}
