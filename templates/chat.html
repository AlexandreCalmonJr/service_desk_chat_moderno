<div class="chat-container" role="application" aria-label="Chat do assistente de service desk">
    <div class="chat-header">
        <h2 class="chat-title">
            <i class="fas fa-robot" aria-hidden="true"></i>
            Sou seu assistente de Service Desk
        </h2>
        <p class="chat-subtitle">Como posso ajudar hoje?</p>
    </div>
    
    <div class="chat-body" id="chatBox" role="log" aria-live="polite" aria-label="Histórico de conversas">
        <div class="chat-message bot" role="article">
            <div class="avatar" aria-hidden="true">
                <i class="fas fa-robot"></i>
            </div>
            <div class="message-bubble">
                <p>Olá! Como posso ajudar você hoje? Tente "Encerrar chamado &lt;ID&gt;", "Sugerir solução para &lt;problema&gt;", ou faça uma pergunta!</p>
            </div>
        </div>
    </div>
    
    <div class="chat-footer p-4 bg-gray-800 border-t border-gray-700">
        <div class="typing-indicator" id="typing-indicator" style="display: none;">
            <span class="text-gray-400">Digitando...</span>
        </div>
        <div class="flex items-center space-x-2">
            <textarea 
                id="chat-input" 
                class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md shadow-sm text-white placeholder-gray-400 focus:outline-none focus:ring-green-500 focus:border-green-500" 
                rows="1" 
                placeholder="Digite sua mensagem..."></textarea>
            <button 
                onclick="enviarMensagem()" 
                class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 focus:ring-offset-gray-800">
                Enviar
            </button>
        </div>
    </div>
    
    <script>
        // >>>>>>>>> AQUI ESTÃO AS CORREÇÕES <<<<<<<<<<<
        const chatBody = document.getElementById('chatBox');       // Corrigido de 'chat-body' para 'chatBox'
        const chatInput = document.getElementById('chat-input');      // Corrigido de 'chatInput' para 'chat-input'
        const typingIndicator = document.getElementById('typing-indicator');
        let chatState = 'normal';
    
        async function enviarMensagem() {
            const mensagem = chatInput.value.trim();
            if (!mensagem) return;
    
            adicionarMensagem(mensagem, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto';
            chatBody.scrollTop = chatBody.scrollHeight;
    
            typingIndicator.style.display = 'flex';
    
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mensagem })
                });
                const data = await response.json();
                adicionarMensagem(data.text, 'bot', data.html, data.options);
                chatState = data.state || 'normal';
                chatInput.placeholder = chatState === 'faq_selection' 
                    ? 'Clique numa FAQ acima ou digite uma nova mensagem...' 
                    : 'Digite sua mensagem...';
            } catch (error) {
                adicionarMensagem('Erro ao processar a solicitação.', 'bot');
                console.error('Erro no chat:', error);
            } finally {
                typingIndicator.style.display = 'none';
                chatBody.scrollTop = chatBody.scrollHeight;
            }
        }
    
        function adicionarMensagem(texto, tipo, isHtml = false, options = []) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${tipo} mb-4 flex items-start`;
    
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'avatar mr-3';
            avatarDiv.innerHTML = tipo === 'user' 
                ? '<i class="fas fa-user text-gray-300"></i>' 
                : '<i class="fas fa-robot text-green-400"></i>';
    
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = tipo === 'user' 
                ? 'message-bubble bg-green-600/30 p-3 rounded-lg w-full text-white' 
                : 'message-bubble bg-gray-700 p-3 rounded-lg w-full text-gray-300';
    
            if (isHtml) {
                bubbleDiv.innerHTML = texto;
            } else {
                bubbleDiv.textContent = texto;
            }
    
            messageDiv.appendChild(tipo === 'user' ? bubbleDiv : avatarDiv);
            messageDiv.appendChild(tipo === 'user' ? avatarDiv : bubbleDiv);
            chatBody.appendChild(messageDiv);
    
            // FAQ opções
            if (options && options.length > 0) {
                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'faq-options mt-2';
                options.forEach(option => {
                    const button = document.createElement('button');
                    button.className = 'faq-option-button px-3 py-1 bg-gray-600 text-white rounded hover:bg-gray-500';
                    button.textContent = option.question;
                    button.onclick = () => selecionarFAQ(option.id);
                    optionsDiv.appendChild(button);
                });
                bubbleDiv.appendChild(optionsDiv);
            }
    
            chatBody.scrollTop = chatBody.scrollHeight;
        }
    
        async function selecionarFAQ(faqId) {
            typingIndicator.style.display = 'flex';
            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mensagem: `faq_${faqId}` })
                });
                const data = await response.json();
                adicionarMensagem(data.text, 'bot', data.html, data.options);
                chatState = data.state || 'normal';
                chatInput.placeholder = chatState === 'faq_selection' 
                    ? 'Clique numa FAQ acima ou digite uma nova mensagem...' 
                    : 'Digite sua mensagem...';
            } catch (error) {
                adicionarMensagem('Erro ao processar a FAQ.', 'bot');
            } finally {
                typingIndicator.style.display = 'none';
                chatBody.scrollTop = chatBody.scrollHeight;
            }
        }
    
        chatInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                enviarMensagem();
            }
        });
    </script>
</div>
